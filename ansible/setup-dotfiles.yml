- hosts: localhost 
  vars:
    home_dir: "{{ ansible_env.HOME }}" 
    dotfiles_dir: "{{ playbook_dir }}/.."
    modules_dir: '/etc/ansible/modules'
    common:
      - software-properties-common
      - bash-completion
      - docker
      - git
      - gpg
      - python3
      - tree
      - watch
      - curl
      - wget
      - zsh
      - neovim
      - vim
  tasks:
  - name: Create ansible directory
    file: path={{ modules_dir }} state=directory
    become: true

  - name: Symlink ansible hosts
    file:
      src: '{{ playbook_dir }}/hosts'
      dest: '/etc/ansible/hosts' 
      state: link
      force: yes
    become: true

  - include_tasks: "tasks/os-specific.yml"
  - include_vars: "{{ os_vars }}"
    when: vars_exist

  - include_vars: "vars/fonts.yml"

  - name: Install NerdFonts
    include_role:
      name: drew-kun.nerdfonts
    vars:
      nerdfonts_fonts: "{{ terminal_fonts }}"

  - include_tasks: "tasks/setup-zsh.yml"

  - name: Symlink config files
    file:
      src: '{{ item.src }}'
      dest: '{{ home_dir }}/{{ item.path }}'
      state: link
      force: yes
    with_community.general.filetree: '{{ dotfiles_dir }}/home/'
    when: item.state == 'file'

  - name: Install with {{ ansible_pkg_mgr }}
    action: >
      {{ ansible_pkg_mgr }} name="{{ utils }}" state=latest
    become: "{{ false if ansible_pkg_mgr == 'homebrew' else true }}"

  - include_tasks: "{{ os_tasks }}"
    when: tasks_exist
